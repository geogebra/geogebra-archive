<?xml version="1.0" encoding="ISO-8859-1" ?>

<!-- README: Downloading external libraries for GeoGebra

This build file is about to download all necessary external libraries
from the Internet. Most files are downloaded from the GeoGebra server
to ensure availability.

-->

<!--
   GeoGebra kickstart build script    
   @author Zoltan Kovacs <zoltan@geogebra.org>
-->

<project default="kickstart-20110923">

	<target name="osarchinfo">
	<echo message="This is a ${os.name} running on ${os.arch}"/>
	</target>

	<target name="info">
	<echo message="****************"/>
	<echo message="* NOW PRESS F5 *"/>
	<echo message="****************"/>
	</target>

	<target name="kickstart-20110923" depends="classpath-open, lib-build-geogebra5, lib-runtime, classpath-close, info"
	    description="(SUGGESTED) For Eclipse developers: to create GeoGebra 4 or 5 builds">
	</target>

	<target name="geogebra4-developer" depends="lib-build-geogebra4, lib-runtime"
	    description="(NOT WORKING YET) For Eclipse developers: to create GeoGebra 4 builds">
	</target>

	<target name="geogebra5-developer" depends="lib-build-geogebra5, lib-runtime"
	    description="For Eclipse developers: to create GeoGebra 5 builds">
	</target>

	<target name="geogebra4-developer-commandline" depends="geogebra4-developer, ecj"
	    description="For command line developers (mostly Unix): to create GeoGebra 4 builds">	
	</target>

	<target name="geogebra4-packager" depends="geogebra4-developer, lib-pack"
	    description="For JAR testers: to create GeoGebra 4 JAR packages">	
	</target>

	<target name="geogebra5-packager" depends="geogebra5-developer, lib-pack"
	    description="(SUGGESTED) For JAR testers: to create GeoGebra 5 JAR packages">	
	</target>

	<target name="geogebra4-packager-commandline" depends="geogebra4-developer-commandline, lib-pack"
	    description="For command line JAR testers (mostly Unix): to create GeoGebra 4 JAR packages">	
	</target>

	<!-- these targets should come from the GeoGebra repository (currently) -->
	<target name="mpreduce" depends="mpreduce-geogebra"/>
	<target name="jogl1" depends="jogl1-geogebra"/>
	<target name="jogl2" depends="jogl2-geogebra"/>
	<target name="jlatexmath" depends="jlatexmath-geogebra"/>
	<target name="p200ant" depends="p200ant-geogebra"/>
	<target name="jsobject" depends="jsobject-geogebra"/>
	<target name="mac_extensions" depends="mac_extensions-geogebra"/>
	<target name="vernier" depends="vernier-geogebra"/>
	<target name="javacc" depends="javacc-geogebra"/>
	<target name="ecj" depends="ecj-geogebra"/>


	<!-- download external libraries -->
	<target name="lib" depends="lib-runtime, lib-build-geogebra5, lib-pack"
	    description="(FALLBACK) Download all packages for the current OS and architecture">
	</target>

	<target name="lib-build-geogebra4" depends="mpreduce, javacc, jsobject, mac_extensions, jlatexmath"
	    description="Download all packages needed for a full build for the current OS and architecture (for GeoGebra 4)">
	</target>

	<target name="lib-build-geogebra5" depends="lib-build-geogebra4, jogl1, jogl2"
	    description="Download all packages needed for a full build for the current OS and architecture (for GeoGebra 5)">
	</target>

	<target name="lib-pack" depends="proguard, p200ant"
	    description="Download all packages needed for creating the JAR files">
	</target>

	<target name="lib-runtime" depends="jlatexmath, vernier"
	    description="Download all packages needed for runtime use">
	</target>

	<!-- detecting operating system and architecture -->
	<condition property="winnt-i386">
		<os family="winnt" arch="i386"/>
	</condition>

	<condition property="winnt-amd64">
		<os family="winnt" arch="amd64"/>
	</condition>

	<condition property="winnt">
		<os family="winnt"/>
	</condition>

	<condition property="mac">
		<os family="mac"/>
	</condition>

	<condition property="unix-i386">
		<os family="unix" arch="i386"/>
	</condition>

	<condition property="unix-amd64">
		<os family="unix" arch="amd64"/>
	</condition>


	<!-- download jlatexmath-minimal.zip directly from Calixte Denizet's repository -->
	<target name="jlatexmath-calixte">
	<mkdir dir="lib/download"/>
	<get src="http://forge.scilab.org/index.php/p/jlatexmath/downloads/253/get/"
	    dest="lib/download/jlatexmath-minimal.zip" usetimestamp="true"/>
	<unzip src="download/jlatexmath-minimal.zip" dest="lib/">
	    <patternset>
		<include name="jlm_*.jar"/>
	    </patternset>
	    <mapper type="glob" from="*.jar" to="*.jar"/>
	</unzip>
	<unzip src="lib/download/jlatexmath-minimal.zip" dest="lib/">
	    <patternset>
		<include name="jlatexmath-*.jar"/>
	    </patternset>
	    <mapper type="glob" from="jlatexmath-minimal-*.jar" to="jlatexmath.jar"/>
	</unzip>
	</target>

	<!-- download jlatexmath from GeoGebra repository -->
	<target name="jlatexmath-geogebra">
	<get src="http://www.geogebra.org/download/lib/jlatexmath.jar" dest="lib/jlatexmath.jar" usetimestamp="true"/>
	<get src="http://www.geogebra.org/download/lib/jlm_cyrillic.jar" dest="lib/jlm_cyrillic.jar" usetimestamp="true"/>
	<get src="http://www.geogebra.org/download/lib/jlm_greek.jar" dest="lib/jlm_greek.jar" usetimestamp="true"/>
	</target>
	
	<!-- download p200ant from GeoGebra repository -->
	<target name="p200ant-geogebra">
	<get src="http://www.geogebra.org/download/lib/build/tools_p200ant_java5only.jar" dest="lib/build/tools_p200ant_java5only.jar"
	    usetimestamp="true"/>
	</target>

	<!-- download jsobject from GeoGebra repository -->
	<target name="jsobject-geogebra">
	<get src="http://www.geogebra.org/download/lib/lib_jsobject.jar" dest="lib/build/lib_jsobject.jar"
	    usetimestamp="true"/>
	</target>

	<!-- download lib_mac_extensions from GeoGebra repository -->
	<target name="mac_extensions-geogebra">
	<get src="http://www.geogebra.org/download/lib/lib_mac_extensions.jar" dest="lib/build/lib_mac_extensions.jar"
	    usetimestamp="true"/>
	</target>

	<!-- download vernier from GeoGebra repository -->
	<target name="vernier-geogebra" depends="vernier-common-geogebra, vernier-windows-geogebra"/>
	
	<target name="vernier-common-geogebra">
	<get src="http://www.geogebra.org/download/lib/vernier_ccsd-macintel-static.jar" dest="lib/vernier_ccsd-macintel-static.jar"
	    usetimestamp="true"/>
	<get src="http://www.geogebra.org/download/lib/vernier_ccsd-mac-static.jar" dest="lib/vernier_ccsd-mac-static.jar"
	    usetimestamp="true"/>
	<get src="http://www.geogebra.org/download/lib/vernier_ccsd-win.jar" dest="lib/vernier_ccsd-win.jar"
	    usetimestamp="true"/>
	</target>

	<target name="vernier-windows-geogebra" if="winnt">
	<unjar src="lib/vernier_ccsd-win.jar" dest="lib/">
	    <patternset>
		<include name="*.dll"/>
	    </patternset>
	    <mapper type="glob" from="*" to="../*"/>
	</unjar>
	</target>

	<!-- download ecj -->
	<target name="ecj-eclipse">
	<mkdir dir="lib/build"/>
	<get 
	    src="http://www.eclipse.org/downloads/download.php?file=/eclipse/downloads/drops/R-3.6.2-201102101200/ecj-3.6.2.jar&amp;url=http://ftp.wh2.tu-dresden.de/pub/mirrors/eclipse/eclipse/downloads/drops/R-3.6.2-201102101200/ecj-3.6.2.jar&amp;mirror_id=324"
	    dest="lib/build/ecj-3.6.2.jar" usetimestamp="true"/>
	</target>
	
	<target name="ecj-geogebra">
	<mkdir dir="lib/build"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/ecj-3.6.2.jar"
	    dest="lib/build/ecj-3.6.2.jar" usetimestamp="true"/>
	</target>
	
	<!-- download mpreduce default.img from GeoGebra repository -->
	<target name="mpreduce-geogebra">
	<get 
	    src="http://www.geogebra.org/download/lib/build/mpreduce/default.img"
	    dest="default.img" usetimestamp="true"/>
	</target>
	
	<!-- download proguard -->
	<target name="proguard">
	<mkdir dir="lib/build"/>
	<mkdir dir="lib/download"/>
	<get 
	    src="http://downloads.sourceforge.net/project/proguard/proguard/4.6/proguard4.6.zip?&amp;use_mirror=heanet"
	    dest="lib/download/proguard46.zip" usetimestamp="true"/>
	<unzip src="lib/download/proguard46.zip" dest="lib/download">
	    <patternset>
		<include name="proguard4.6/lib/proguard.jar"/>
	    </patternset>
	    <mapper type="glob" from="proguard4.6/lib/proguard.jar" to="../build/tools_proguard46.jar"/>
	</unzip>
	</target>

	<!-- download javacc from GeoGebra repository -->
	<target name="javacc-geogebra">
	<mkdir dir="lib/build/javacc"/>
	<get src="http://www.geogebra.org/download/lib/build/javacc/javacc.jar" dest="lib/build/javacc/javacc.jar"
	    usetimestamp="true"/>
	</target>

	<!-- download javacc -->
	<target name="javacc-javanet">
	<mkdir dir="lib/build"/>
	<mkdir dir="lib/download"/>
	<get 
	    src="http://java.net/projects/javacc/downloads/download/javacc-5.0.zip"
	    dest="lib/download/javacc-5.0.zip" usetimestamp="true"/>
	<unzip src="lib/download/javacc-5.0.zip" dest="lib/download">
	    <patternset>
    		<include name="javacc-5.0/bin/lib/javacc.jar"/>
	    </patternset>
	    <mapper type="glob" from="javacc-5.0/bin/lib/javacc.jar" to="../build/javacc/javacc.jar"/>
	</unzip>
	</target>

	<!-- dowload jogl1 from GeoGebra repository -->
	<target name="jogl1-geogebra" depends="jogl1-linux-geogebra, jogl1-macosx-geogebra, jogl1-windows-geogebra, jogl1-jar-geogebra"/>

	<target name="jogl1-jar-geogebra">
	<mkdir dir="lib/build/jogl1/jar"/>
	<mkdir dir="lib/download"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl1/jogl1-jar.zip"
	    dest="lib/download/jogl1-jar.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl1-jar.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl1/*"/>
	</unzip>
        <echo file=".classpath" append="true">
        &lt;/classpathentry&gt;
    
        &lt;classpathentry kind="lib" path="lib/build/jogl1/jar/gluegen-rt.jar"/&gt;
	&lt;classpathentry kind="lib" path="lib/build/jogl1/jar/jogl.jar"/&gt;
	</echo>
	</target>
	
	<target name="jogl1-linux-geogebra" depends="jogl1-linux-amd64-geogebra, jogl1-linux-i586-geogebra"/>
	<target name="jogl1-windows-geogebra" depends="jogl1-winnt-amd64-geogebra, jogl1-winnt-i586-geogebra"/>

	<target name="jogl1-linux-amd64-geogebra" if="unix-amd64">
	<mkdir dir="lib/download"/>
	<mkdir dir="lib/build/jogl1/linux-amd64"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl1/jogl1-linux-amd64.zip"
	    dest="lib/download/jogl1-linux-amd64.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl1-linux-amd64.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl1/*"/>
	</unzip>
	<echo file=".classpath" append="true">
		&lt;attributes&gt;
			&lt;attribute name="org.eclipse.jdt.launching.CLASSPATH_ATTR_LIBRARY_PATH_ENTRY" value="geogebra/lib/build/jogl1/linux-amd64"/&gt;
		&lt;/attributes&gt;
	</echo>
	</target>

	<target name="jogl1-linux-i586-geogebra" if="unix-i386">
	<mkdir dir="lib/download"/>
	<mkdir dir="lib/build/jogl1/linux-i586"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl1/jogl1-linux-i586.zip"
	    dest="lib/download/jogl1-linux-i586.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl1-linux-i586.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl1/*"/>
	</unzip>
	<echo file=".classpath" append="true">
		&lt;attributes&gt;
			&lt;attribute name="org.eclipse.jdt.launching.CLASSPATH_ATTR_LIBRARY_PATH_ENTRY" value="geogebra/lib/build/jogl1/linux-i586"/&gt;
		&lt;/attributes&gt;
	</echo>
	</target>

	<target name="jogl1-macosx-geogebra" if="mac">
	<mkdir dir="lib/build/jogl1/macosx"/>
	<mkdir dir="lib/download"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl1/jogl1-macosx.zip"
	    dest="lib/download/jogl1-macosx.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl1-macosx.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl1/*"/>
	</unzip>
	<echo file=".classpath" append="true">
		&lt;attributes&gt;
			&lt;attribute name="org.eclipse.jdt.launching.CLASSPATH_ATTR_LIBRARY_PATH_ENTRY" value="geogebra/lib/build/jogl1/macosx"/&gt;
		&lt;/attributes&gt;
	</echo>
	</target>

	<target name="jogl1-winnt-amd64-geogebra" if="winnt-amd64">
	<mkdir dir="lib/download"/>
	<mkdir dir="lib/build/jogl1/windows-amd64"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl1/jogl1-windows-amd64.zip"
	    dest="lib/download/jogl1-windows-amd64.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl1-windows-amd64.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl1/*"/>
	</unzip>

	<echo file=".classpath" append="true">
		&lt;attributes&gt;
			&lt;attribute name="org.eclipse.jdt.launching.CLASSPATH_ATTR_LIBRARY_PATH_ENTRY" value="geogebra/lib/build/jogl1/windows-amd64"/&gt;
		&lt;/attributes&gt;

	</echo>
	</target>
	
	<target name="jogl1-winnt-i586-geogebra" if="winnt-i386">
	<mkdir dir="lib/build/jogl1/windows-i586"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl1/jogl1-windows-i586.zip"
	    dest="lib/download/jogl1-windows-i586.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl1-windows-i586.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl1/*"/>
	</unzip>
	<echo file=".classpath" append="true">
		&lt;attributes&gt;
			&lt;attribute name="org.eclipse.jdt.launching.CLASSPATH_ATTR_LIBRARY_PATH_ENTRY" value="geogebra/lib/build/jogl1/windows-i586"/&gt;
		&lt;/attributes&gt;
	</echo>
	</target>

	<!-- dowload jogl2 from GeoGebra repository -->
	<target name="jogl2-geogebra" depends="jogl2-linux-geogebra, jogl2-macosx-geogebra, jogl2-windows-geogebra"/>

	<target name="jogl2-linux-geogebra" if="unix">
	<mkdir dir="lib/download"/>
	<mkdir dir="lib/build/jogl2/linux-amd64"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl2/jogl2-linux-amd64.zip"
	    dest="lib/download/jogl2-linux-amd64.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl2-linux-amd64.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl2/*"/>
	</unzip>
	<mkdir dir="lib/build/jogl2/linux-i586"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl2/jogl2-linux-i586.zip"
	    dest="lib/download/jogl2-linux-i586.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl2-linux-i586.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl2/*"/>
	</unzip>
	</target>

	<target name="jogl2-macosx-geogebra" if="mac">
	<mkdir dir="lib/build/jogl2-macosx"/>
	<mkdir dir="lib/download"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl2/jogl2-macosx.zip"
	    dest="lib/download/jogl2-macosx.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl2-macosx.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl2/*"/>
	</unzip>
	</target>

	<target name="jogl2-windows-geogebra" if="winnt">
	<mkdir dir="lib/download"/>
	<mkdir dir="lib/build/jogl2/windows-amd64"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl2/jogl2-windows-amd64.zip"
	    dest="lib/download/jogl2-windows-amd64.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl2-windows-amd64.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl2/*"/>
	</unzip>
	<mkdir dir="lib/build/jogl2/windows-i586"/>
	<get 
	    src="http://www.geogebra.org/download/lib/build/jogl2/jogl2-windows-i586.zip"
	    dest="lib/download/jogl2-windows-i586.zip" usetimestamp="true"/>
	<unzip src="lib/download/jogl2-windows-i586.zip" dest="lib/">
	    <mapper type="glob" from="*" to="build/jogl2/*"/>
	</unzip>
	</target>

	<target name="classpath-open">
	<echo file=".classpath" append="false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
	&lt;!-- This Eclipse .classpath file has been generated by the kickstart.xml Ant script.
    		Please do not edit. It will be overwritten each time you run kickstart.xml,
    		depending on your local OS and architecture settings. --&gt;
     
	&lt;classpath&gt;
	
	&lt;classpathentry excluding="build/|icons/|installer/|lib/|scripts/|webstart/|xsd/" kind="src" path=""&gt;
	</echo>
	</target>

	<target name="classpath-close">
	<echo file=".classpath" append="true">
	&lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/J2SE-1.5"/&gt;

	&lt;classpathentry kind="lib" path="lib/build/lib_jsobject.jar"/&gt;
	&lt;classpathentry kind="lib" path="lib/build/lib_mac_extensions.jar"/&gt;
	&lt;classpathentry kind="lib" path="lib/jlatexmath.jar"/&gt;
	&lt;classpathentry kind="lib" path="lib/jlm_greek.jar"/&gt;
	&lt;classpathentry kind="lib" path="lib/jlm_cyrillic.jar"/&gt;

	&lt;classpathentry kind="output" path=""/&gt;

	&lt;/classpath&gt;
	</echo>
	</target>

</project>
