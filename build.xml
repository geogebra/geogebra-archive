<?xml version="1.0" ?>
<!--
need to add tools.jar from jdk 1.4.2 into the runtime classpath of ANT (windows->preferences->ant->Runtime->add jars..)

also
1) remove all the installed JREs from the Window -> Preferences -> Java -> Installed JREs

2) add a JRE with the path to root J2SDK folder (JRE home directory: C:\j2sdk1.4.2_17) with the (JRE name: j2re1.4.2_17).


-->
<project default="dist">
	
	<property name="src.dir" location="."/>
	<property name="build.dir" location="../build"/>
	<property name="dist.dir"  location="../build"/>
	<property name="dist_properties.dir"  location="../dist_properties"/>
	<property name="dist_export.dir"  location="../dist_export"/>
	
	 <manifest file="MANIFEST.MF">
	      <attribute name="Class-Path" value="geogebra_properties.jar geogebra_export.jar"/>
	      <attribute name="Main-Class" value="geogebra.gui.MyAppSplash"/>
	  </manifest>	
	
	<path id="project.classpath">
		<pathelement path="${java.class.path}"/>
		<fileset dir=".">
			<include name="**/*.jar"/>
		</fileset>
	</path>
	
	<target name="clean">
		<delete dir="${dist.dir}" />
		<delete dir="${build.dir}"/>
	</target>
	
    <target name="dist" depends="clean, compile, compress, compress2, compress3, sign, sign2, sign3">
        <echo>
            Building geogebra_unsigned.jar file.
        </echo>
    </target>
  
    <target name="compile" description="Compilation target">
    	<mkdir dir="${build.dir}"/>
        <javac srcdir="${src.dir}" destdir="${build.dir}">
			<classpath refid="project.classpath" />
        </javac>
    	<copy todir="${build.dir}">
    		<fileset dir="${src.dir}">
    			<exclude name="*.jar"/>
    			<include name="LICENSE.TXT"/>
    			<include name="**com/**"/>
    			<include name="META-INF/**"/>
    			<include name="**/*.png"/>
    			<include name="**/*.gif"/>
    			<include name="**/*.jpg"/>
    			<include name="**/*.properties"/>
    		</fileset>
    	</copy>
    </target>
  
	<target name="compress" depends="compile" description="Compression target">
		<mkdir dir="${dist.dir}"/>
			<jar jarfile="${dist.dir}/geogebra_unsigned.jar"
			manifest="MANIFEST.MF"
			basedir="${build.dir}"
			includes="**/*.class **/*.png, **/*.gif, **/*.jpg"
			excludes="org/**, tutor/**, geogebra/export/**, *.jar, **/*.properties"
			/>
	</target>
	
	<target name="compress2" depends="compile" description="Compression target">
		<mkdir dir="${dist.dir}"/>
			<jar jarfile="${dist.dir}/geogebra_export_unsigned.jar"
			manifest="MANIFEST.MF"
			basedir="${build.dir}"
			includes="META-INF/services/**, org/**, geogebra/export/**"
			/>
	</target>
	
	<target name="compress3" depends="compile" description="Compression target">
		<mkdir dir="${dist.dir}"/>
			<jar jarfile="${dist.dir}/geogebra_properties_unsigned.jar"
			manifest="MANIFEST.MF"
			basedir="${build.dir}"
			includes="geogebra/properties/**"
			excludes="org/**, tutor/**, geogebra/export/**, *.jar"
			/>
	</target>
	
	<target name="sign" depends="compress">
		
		<signjar keystore="../keystore"
			jar="${dist.dir}/geogebra_unsigned.jar"
			signedjar="${dist.dir}/geogebra.jar"
			alias="mhohen"
			storepass="mhohen" />
	
		
	</target>
	
	<target name="sign2" depends="compress2">
		
		<signjar keystore="../keystore"
			jar="${dist.dir}/geogebra_export_unsigned.jar"
			signedjar="${dist.dir}/geogebra_export.jar"
			alias="mhohen"
			storepass="mhohen" />
	
		
	</target>
	<target name="sign3" depends="compress3">
		
		<signjar keystore="../keystore"
			jar="${dist.dir}/geogebra_properties_unsigned.jar"
			signedjar="${dist.dir}/geogebra_properties.jar"
			alias="mhohen"
			storepass="mhohen" />
	
		
	</target>

</project>